Version 4
SHEET 1 2012 1412
WIRE 48 64 -16 64
WIRE 176 64 112 64
WIRE 288 64 240 64
WIRE 416 64 352 64
WIRE -640 128 -848 128
WIRE -528 128 -640 128
WIRE -432 128 -528 128
WIRE -112 128 -160 128
WIRE -16 128 -16 64
WIRE -16 128 -112 128
WIRE 176 128 176 64
WIRE 240 128 240 64
WIRE 240 128 176 128
WIRE 416 128 416 64
WIRE 560 128 416 128
WIRE 752 128 640 128
WIRE 1552 128 832 128
WIRE -16 176 -16 128
WIRE 48 176 -16 176
WIRE 176 176 176 128
WIRE 176 176 128 176
WIRE 240 176 240 128
WIRE 288 176 240 176
WIRE 416 176 416 128
WIRE 416 176 368 176
WIRE 1552 272 1552 128
WIRE -640 304 -640 128
WIRE -432 304 -432 128
WIRE -848 320 -848 128
WIRE -160 320 -160 128
WIRE -848 480 -848 384
WIRE -640 480 -640 384
WIRE -640 480 -848 480
WIRE -432 480 -432 384
WIRE -432 480 -640 480
WIRE -160 480 -160 400
WIRE -160 480 -432 480
WIRE 288 480 -160 480
WIRE 1552 480 1552 336
WIRE 1552 480 368 480
WIRE -848 512 -848 480
WIRE 64 944 0 944
WIRE 192 944 128 944
WIRE 304 944 256 944
WIRE 432 944 368 944
WIRE -624 1008 -832 1008
WIRE -512 1008 -624 1008
WIRE -416 1008 -512 1008
WIRE -256 1008 -416 1008
WIRE -96 1008 -144 1008
WIRE 0 1008 0 944
WIRE 0 1008 -96 1008
WIRE 192 1008 192 944
WIRE 256 1008 256 944
WIRE 256 1008 192 1008
WIRE 432 1008 432 944
WIRE 576 1008 432 1008
WIRE 768 1008 656 1008
WIRE 1568 1008 848 1008
WIRE 0 1056 0 1008
WIRE 64 1056 0 1056
WIRE 192 1056 192 1008
WIRE 192 1056 144 1056
WIRE 256 1056 256 1008
WIRE 304 1056 256 1056
WIRE 432 1056 432 1008
WIRE 432 1056 384 1056
WIRE 1568 1152 1568 1008
WIRE -624 1184 -624 1008
WIRE -416 1184 -416 1008
WIRE -832 1200 -832 1008
WIRE -144 1200 -144 1008
WIRE -256 1216 -256 1008
WIRE -192 1216 -256 1216
WIRE -192 1264 -256 1264
WIRE -832 1360 -832 1264
WIRE -624 1360 -624 1264
WIRE -624 1360 -832 1360
WIRE -416 1360 -416 1264
WIRE -416 1360 -624 1360
WIRE -256 1360 -256 1264
WIRE -256 1360 -416 1360
WIRE -144 1360 -144 1280
WIRE -144 1360 -256 1360
WIRE 304 1360 -144 1360
WIRE 1568 1360 1568 1216
WIRE 1568 1360 384 1360
WIRE -832 1392 -832 1360
FLAG -848 512 0
FLAG -528 128 vsoc
FLAG -832 1392 0
FLAG -512 1008 vsoc1
FLAG -96 1008 batt1
FLAG -112 128 batt
SYMBOL res 144 160 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 0.1
SYMBOL res 384 160 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 0.1
SYMBOL res 656 112 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 0.1
SYMBOL cap 112 48 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C1
SYMATTR Value 1000p
SYMBOL cap 352 48 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value 10µ
SYMBOL res -656 288 R0
SYMATTR InstName R5
SYMATTR Value 10k
SYMBOL cap -864 320 R0
SYMATTR InstName C3
SYMATTR Value 18000
SYMBOL bi -432 304 R0
SYMATTR InstName B1
SYMATTR Value I=I(R6)
SYMBOL res 384 464 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 1m
SYMBOL bv -160 304 R0
WINDOW 3 58 70 Left 2
SYMATTR Value V=4.2*(-8.0128*pwr(V(vsoc),5) + 22.509*pwr(V(vsoc),4) - 19.929*pwr(V(vsoc),3) + 4.332*pwr(V(vsoc),2) + 2.0965*V(vsoc) + 0.0026)
SYMATTR InstName B2
SYMBOL ind 736 144 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 1n
SYMBOL load 1536 272 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName I1
SYMATTR Value 1
SYMBOL res 160 1040 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 0.1
SYMBOL res 400 1040 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 0.1
SYMBOL res 672 992 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 0.1
SYMBOL cap 128 928 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C4
SYMATTR Value 1000p
SYMBOL cap 368 928 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C5
SYMATTR Value 10µ
SYMBOL res -640 1168 R0
SYMATTR InstName R9
SYMATTR Value 10k
SYMBOL cap -848 1200 R0
SYMATTR InstName C6
SYMATTR Value 18000
SYMBOL bi -416 1184 R0
SYMATTR InstName B3
SYMATTR Value I=I(R10)
SYMBOL res 400 1344 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 1m
SYMBOL ind 752 1024 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L2
SYMATTR Value 1n
SYMBOL load 1552 1152 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName I2
SYMATTR Value 1
SYMBOL e -144 1184 R0
SYMATTR InstName E1
SYMATTR Value table(0 0, 0.1 0.25, 0.3 0.65, 0.4 0.77, 0.5 0.79, 0.6 0.8, 0.7 0.82, 0.8 0.85, 0.9 0.9, 1 1)
TEXT 200 -72 Left 2 !.tran 18000
TEXT -928 416 VLeft 2 ;Ccapacity\n5Ahr battery
TEXT -184 -40 Left 2 ;Short and long time constant transient response, and instantaneous voltage drop, wire inductance.\nRandles model can't be done in spice.
TEXT 248 416 Left 2 ;sense resistor
TEXT -136 432 Left 2 ;Voc
TEXT -552 88 Left 2 !.ic V(vsoc)=1
TEXT -768 584 Left 2 ;Ccapacity = 3600*Capacity(Ahr)*f1(Cycle)*f2(Temp)\nvsoc initial condition of 1V is 100% SOC, 0V is 0% SOC\ncycle number and temperature not factored in here \n1amp=1coul/sec\nQ=C x V ( coulomb=capacitance x voltage)\nso how many Coulombs in a 5Ahr battery?\n5Ahr = (5 C/S) x 1Hr = 3600 S/Hr x 5C/S x 1Hr = 18000C = 18000F x 1V
TEXT -680 416 VLeft 2 ;Rselfdischarge
TEXT 928 544 Left 2 ;Polynomial derived from this table\n \nvsoc            voc\n1               1\n0.9             0.9\n0.8             0.85\n0.7             0.82\n0.6             0.8\n0.5             0.79\n0.4             0.77\n0.3             0.65\n0.2             0.45\n0.1             0.25\n0               0
TEXT -120 1312 Left 2 ;Voc
TEXT -544 968 Left 2 !.ic V(vsoc1)=1
